# –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ç–∞ –ó–∞–ø—É—Å–∫ –ú—ñ–≥—Ä–∞—Ü—ñ–π –ë–∞–∑–∏ –î–∞–Ω–∏—Ö

## üìã –û–≥–ª—è–¥

–ü—ñ—Å–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ –±–∞–≥–∞—Ç—å–æ—Ö –º–æ–≤ –¥–ª—è –±–ª–æ–≥—É, –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–∫–æ–Ω–∞—Ç–∏ –º—ñ–≥—Ä–∞—Ü—ñ—é –±–∞–∑–∏ –¥–∞–Ω–∏—Ö, —è–∫–∞ –¥–æ–¥–∞—Å—Ç—å –Ω–æ–≤—ñ –ø–æ–ª—è –¥–æ —Ç–∞–±–ª–∏—Ü—ñ `blogs`.

## üîç –ö—Ä–æ–∫ 1: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ü–æ—Ç–æ—á–Ω–æ–≥–æ –°—Ç–∞–Ω—É –ú—ñ–≥—Ä–∞—Ü—ñ–π

### –ù–∞ —Å–µ—Ä–≤–µ—Ä—ñ (–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ backend):

```bash
# –ü—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—è –¥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ backend
docker exec -it skrynia_backend_prod bash

# –ê–±–æ —è–∫—â–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–∞–∑–∏–≤–∞—î—Ç—å—Å—è —ñ–Ω–∞–∫—à–µ
docker ps  # –∑–Ω–∞–π—Ç–∏ –Ω–∞–∑–≤—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ backend
docker exec -it <–Ω–∞–∑–≤–∞_–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞> bash

# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø–æ—Ç–æ—á–Ω—É –≤–µ—Ä—Å—ñ—é –º—ñ–≥—Ä–∞—Ü—ñ—ó
alembic current

# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —ñ—Å—Ç–æ—Ä—ñ—é –º—ñ–≥—Ä–∞—Ü—ñ–π
alembic history

# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —è–∫—ñ –º—ñ–≥—Ä–∞—Ü—ñ—ó —â–µ –Ω–µ –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω—ñ
alembic heads
```

## üöÄ –ö—Ä–æ–∫ 2: –ó–∞–ø—É—Å–∫ –ú—ñ–≥—Ä–∞—Ü—ñ—ó

### –í–∞—Ä—ñ–∞–Ω—Ç 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –≤—Å—ñ—Ö –º—ñ–≥—Ä–∞—Ü—ñ–π

```bash
# –í –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ backend
alembic upgrade head
```

### –í–∞—Ä—ñ–∞–Ω—Ç 2: –ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ—ó –º—ñ–≥—Ä–∞—Ü—ñ—ó

```bash
# –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É –º—ñ–≥—Ä–∞—Ü—ñ—é
alembic upgrade add_multilingual_blog
```

### –í–∞—Ä—ñ–∞–Ω—Ç 3: –ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –∑ –ø–µ—Ä–µ–≤—ñ—Ä–∫–æ—é

```bash
# –°–ø–æ—á–∞—Ç–∫—É –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ –±—É–¥–µ –∑—Ä–æ–±–ª–µ–Ω–æ (dry-run)
alembic upgrade head --sql

# –Ø–∫—â–æ –≤—Å–µ –û–ö, –∑–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏
alembic upgrade head
```

## üìù –ö—Ä–æ–∫ 3: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –†–µ–∑—É–ª—å—Ç–∞—Ç—É

### –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü—ñ blogs:

```bash
# –í –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ backend, –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—è –¥–æ PostgreSQL
psql -h db -U your_db_user -d your_db_name

# –ê–±–æ —á–µ—Ä–µ–∑ docker exec
docker exec -it skrynia_db_prod psql -U your_db_user -d your_db_name

# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü—ñ
\d blogs

# –ê–±–æ —á–µ—Ä–µ–∑ SQL
SELECT column_name, data_type, is_nullable 
FROM information_schema.columns 
WHERE table_name = 'blogs' 
ORDER BY ordinal_position;
```

### –û—á—ñ–∫—É–≤–∞–Ω—ñ –Ω–æ–≤—ñ –ø–æ–ª—è:

- `title_uk`, `title_en`, `title_de`, `title_pl`, `title_se`, `title_no`, `title_dk`, `title_fr`
- `excerpt_uk`, `excerpt_en`, `excerpt_de`, `excerpt_pl`, `excerpt_se`, `excerpt_no`, `excerpt_dk`, `excerpt_fr`
- `content_uk`, `content_en`, `content_de`, `content_pl`, `content_se`, `content_no`, `content_dk`, `content_fr`

## ‚ö†Ô∏è –ö—Ä–æ–∫ 4: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ú—ñ–≥—Ä–∞—Ü—ñ—ó –î–∞–Ω–∏—Ö

–ú—ñ–≥—Ä–∞—Ü—ñ—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Å–∫–æ–ø—ñ—é—î –¥–∞–Ω—ñ –∑ legacy –ø–æ–ª—ñ–≤ (`title`, `excerpt`, `content`) –≤ –Ω–æ–≤—ñ –ø–æ–ª—è (`title_uk`, `excerpt_uk`, `content_uk`).

–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –º–æ–∂–Ω–∞ —Ç–∞–∫:

```sql
-- –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ –¥–∞–Ω—ñ –º—ñ–≥—Ä–æ–≤–∞–Ω—ñ
SELECT id, title, title_uk, content, content_uk 
FROM blogs 
LIMIT 5;
```

## üîÑ –ö—Ä–æ–∫ 5: –í—ñ–¥–∫–∞—Ç (—è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ)

–Ø–∫—â–æ —â–æ—Å—å –ø—ñ—à–ª–æ –Ω–µ —Ç–∞–∫, –º–æ–∂–Ω–∞ –≤—ñ–¥–∫–æ—Ç–∏—Ç–∏ –º—ñ–≥—Ä–∞—Ü—ñ—é:

```bash
# –í—ñ–¥–∫–æ—Ç–∏—Ç–∏ –Ω–∞ –æ–¥–Ω—É –º—ñ–≥—Ä–∞—Ü—ñ—é –Ω–∞–∑–∞–¥
alembic downgrade -1

# –ê–±–æ –≤—ñ–¥–∫–æ—Ç–∏—Ç–∏ –¥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ—ó –≤–µ—Ä—Å—ñ—ó
alembic downgrade <revision_id>
```

## üê≥ –Ø–∫—â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è Docker Compose

### –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å –º—ñ–≥—Ä–∞—Ü—ñ–π:

```bash
# –ó —Ö–æ—Å—Ç–∞
docker exec skrynia_backend_prod alembic current
```

### –ó–∞–ø—É—Å—Ç–∏—Ç–∏ –º—ñ–≥—Ä–∞—Ü—ñ—é:

```bash
# –ó —Ö–æ—Å—Ç–∞
docker exec skrynia_backend_prod alembic upgrade head
```

### –ê–±–æ —á–µ—Ä–µ–∑ docker-compose:

```bash
# –ó –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó –ø—Ä–æ–µ–∫—Ç—É
docker-compose -f docker-compose.prod.yml exec backend alembic upgrade head
```

## üìä –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –õ–æ–≥—ñ–≤

–Ø–∫—â–æ –≤–∏–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º–∏, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏:

```bash
# –õ–æ–≥–∏ backend –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker logs skrynia_backend_prod --tail 100

# –ê–±–æ –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ
docker logs -f skrynia_backend_prod
```

## ‚úÖ –ü—ñ—Å–ª—è –£—Å–ø—ñ—à–Ω–æ—ó –ú—ñ–≥—Ä–∞—Ü—ñ—ó

1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ backend –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (—è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ):
   ```bash
   docker restart skrynia_backend_prod
   ```

2. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ API –ø—Ä–∞—Ü—é—î:
   ```bash
   curl https://runebox.eu/api/v1/blog/
   ```

3. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∞–¥–º—ñ–Ω –ø–∞–Ω–µ–ª—å:
   - –í—ñ–¥–∫—Ä–∏—Ç–∏ `/admin/blog`
   - –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä `/admin/blog/editor` –ø—Ä–∞—Ü—é—î

## üîß Troubleshooting

### –ü–æ–º–∏–ª–∫–∞: "relation already exists"
- –ú—ñ–≥—Ä–∞—Ü—ñ—è –≤–∂–µ –±—É–ª–∞ –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω–∞ —Ä–∞–Ω—ñ—à–µ
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ: `alembic current`

### –ü–æ–º–∏–ª–∫–∞: "column does not exist"
- –ú—ñ–≥—Ä–∞—Ü—ñ—è –Ω–µ –±—É–ª–∞ –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω–∞
- –ó–∞–ø—É—Å—Ç—ñ—Ç—å: `alembic upgrade head`

### –ü–æ–º–∏–ª–∫–∞: "could not connect to server"
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —â–æ –±–∞–∑–∞ –¥–∞–Ω–∏—Ö –∑–∞–ø—É—â–µ–Ω–∞
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∑–º—ñ–Ω–Ω—ñ –æ—Ç–æ—á–µ–Ω–Ω—è (DATABASE_URL)

## üìå –í–∞–∂–ª–∏–≤–æ

- **–ó—Ä–æ–±—ñ—Ç—å backup –±–∞–∑–∏ –¥–∞–Ω–∏—Ö** –ø–µ—Ä–µ–¥ –º—ñ–≥—Ä–∞—Ü—ñ—î—é:
  ```bash
  docker exec skrynia_db_prod pg_dump -U your_db_user your_db_name > backup_$(date +%Y%m%d_%H%M%S).sql
  ```

- –ú—ñ–≥—Ä–∞—Ü—ñ—è **–Ω–µ –≤–∏–¥–∞–ª—è—î** —Å—Ç–∞—Ä—ñ –ø–æ–ª—è (`title`, `excerpt`, `content`) –¥–ª—è backward compatibility
- –ù–æ–≤—ñ –ø–æ–ª—è `title_uk` —Ç–∞ `content_uk` —î **–æ–±–æ–≤'—è–∑–∫–æ–≤–∏–º–∏** (NOT NULL)

